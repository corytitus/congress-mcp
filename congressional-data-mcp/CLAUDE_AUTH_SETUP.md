# üîê Claude Desktop & Code Authentication Setup

This guide will help you set up the authenticated EnactAI MCP Server with Claude Desktop and Claude Code.

## ‚úÖ What We've Set Up

1. **Token Management System** - Secure API tokens with permissions
2. **Authenticated MCP Server** - Local server that requires tokens
3. **Claude Integration** - Ready for both Desktop and Code

## üöÄ Quick Start for Claude Desktop

### Step 1: Copy Your Token

Your token has been created:
```
Token ID: 8e0a7ae5c25728f3
Token: enact_D7WFVT_HPj7Y4nSCJf9v9wlAMZAlgEKkmoMp2a3Gcn8
```

**‚ö†Ô∏è IMPORTANT: Save this token securely - it cannot be retrieved again!**

### Step 2: Update Claude Desktop Configuration

1. Open Claude Desktop settings
2. Find the Claude Desktop configuration file:
   - macOS: `~/Library/Application Support/Claude/claude_desktop_config.json`
   - Windows: `%APPDATA%\Claude\claude_desktop_config.json`
   - Linux: `~/.config/Claude/claude_desktop_config.json`

3. Add this configuration:

```json
{
  "mcpServers": {
    "enactai-data-auth": {
      "command": "/Users/corytitus/Documents/GitHub/congress-mcp/congressional-data-mcp/run_auth.sh"
    }
  }
}
```

### Step 3: Restart Claude Desktop

1. Quit Claude Desktop completely
2. Start it again
3. You should see "enactai-data-auth" in the MCP servers list

### Step 4: Authenticate in Claude

When you start a new conversation, first authenticate:

```
Use the authenticate tool with token: enact_D7WFVT_HPj7Y4nSCJf9v9wlAMZAlgEKkmoMp2a3Gcn8
```

Claude will respond with:
```json
{
  "status": "authenticated",
  "name": "Claude Desktop Access",
  "permissions": "standard",
  "message": "Successfully authenticated as 'Claude Desktop Access' with standard permissions"
}
```

### Step 5: Use the Tools

Now you can use any of the legislative data tools:
- `search_bills` - Search for congressional bills
- `get_bill` - Get detailed bill information
- `get_member` - Get member of Congress details
- `get_votes` - Get recent votes
- And more!

## üñ•Ô∏è For Claude Code (CLI)

### Option 1: Use the Authenticated Server Directly

```bash
# Start the server
cd /Users/corytitus/Documents/GitHub/congress-mcp/congressional-data-mcp
REQUIRE_AUTH=true python3 enactai_server_local_auth.py
```

### Option 2: Use with MCP Inspector

```bash
# Install MCP Inspector if needed
npm install -g @modelcontextprotocol/inspector

# Run with authentication
cd /Users/corytitus/Documents/GitHub/congress-mcp/congressional-data-mcp
npx @modelcontextprotocol/inspector ./run_auth.sh
```

Then authenticate with your token in the inspector.

## üìä Managing Your Tokens

### View All Tokens
```bash
python3 token_manager.py list
```

### Check Token Usage
```bash
python3 token_manager.py stats 8e0a7ae5c25728f3
```

### Create Additional Tokens
```bash
# For another user/app
python3 token_manager.py create "Another App" --permissions read_only

# With expiration
python3 token_manager.py create "Temporary Access" --expires-days 7
```

### Revoke a Token
```bash
python3 token_manager.py revoke <token_id>
```

## üîí Permission Levels

- **read_only**: Can only read data (search, get info)
- **standard**: Read + standard operations (most tools)
- **admin**: Full access to all tools

Your current token has **standard** permissions.

## üß™ Testing the Setup

### Test in Terminal
```bash
# Run the test script
python3 test_auth.py
```

### Test Authentication
```bash
# Start server in one terminal
./run_auth.sh

# In another terminal, test with curl
curl -X POST http://localhost:8000/authenticate \
  -H "Content-Type: application/json" \
  -d '{"token": "enact_D7WFVT_HPj7Y4nSCJf9v9wlAMZAlgEKkmoMp2a3Gcn8"}'
```

## ‚öôÔ∏è Environment Variables

Create a `.env` file for API keys:
```bash
# API Keys (optional but recommended)
CONGRESS_GOV_API_KEY=your_congress_api_key
GOVINFO_API_KEY=your_govinfo_api_key

# Authentication
REQUIRE_AUTH=true
TOKEN_SECRET_KEY=<auto-generated>
```

## üö® Troubleshooting

### "Not authenticated" error
- Make sure you run the `authenticate` tool first with your token
- Check that the token hasn't been revoked

### "Permission denied" error
- Your token doesn't have permission for that tool
- Create a new token with higher permissions if needed

### Server won't start
- Check that Python 3.7+ is installed
- Install requirements: `pip install mcp httpx`
- Make sure the path in Claude config is correct

### Token not working
- Tokens are case-sensitive, copy exactly
- Check if token is still active: `python3 token_manager.py list`
- Create a new token if needed

## üìù Example Claude Conversation

```
You: Authenticate with token enact_D7WFVT_HPj7Y4nSCJf9v9wlAMZAlgEKkmoMp2a3Gcn8

Claude: Successfully authenticated! You now have access to the EnactAI legislative data tools.

You: Search for recent bills about climate change

Claude: [Uses search_bills tool with your authenticated token]
Here are recent bills about climate change...

You: Get details on HR 1234

Claude: [Uses get_bill tool]
Here are the details for HR 1234...
```

## üîÑ Next Steps

1. **Test the authentication** with Claude Desktop
2. **Monitor usage** with `python3 token_manager.py stats`
3. **Add more tokens** for different apps/users as needed
4. **Set up API keys** for Congress.gov and GovInfo.gov for better rate limits

## üìö Additional Resources

- [Token Manager CLI Documentation](./token_manager.py)
- [MCP Protocol Documentation](https://modelcontextprotocol.io)
- [Congress.gov API](https://api.congress.gov)
- [GovInfo API](https://api.govinfo.gov)

---

**Your authenticated MCP server is ready to use!** üéâ